From ff203160d5ddbf1d8cc5284ca32f97dd6e1105d5 Mon Sep 17 00:00:00 2001
From: Andrei Gherzan <andrei@resin.io>
Date: Tue, 17 Apr 2018 12:00:52 +0100
Subject: [PATCH] Add balena fin dts

Signed-off-by: Andrei Gherzan <andrei@resin.io>
---
 arch/arm/boot/dts/overlays/Makefile               |   1 +
 arch/arm/boot/dts/overlays/balena-fin-overlay.dts | 102 ++++++++++++++++++++++
 2 files changed, 103 insertions(+)
 create mode 100644 arch/arm/boot/dts/overlays/balena-fin-overlay.dts

diff --git a/arch/arm/boot/dts/overlays/Makefile b/arch/arm/boot/dts/overlays/Makefile
index 758fc6e..f167ecd 100644
--- a/arch/arm/boot/dts/overlays/Makefile
+++ b/arch/arm/boot/dts/overlays/Makefile
@@ -15,6 +15,7 @@ dtbo-$(CONFIG_ARCH_BCM2835) += \
 	audioinjector-addons.dtbo \
 	audioinjector-wm8731-audio.dtbo \
 	audremap.dtbo \
+	balena-fin.dtbo \
 	bmp085_i2c-sensor.dtbo \
 	dht11.dtbo \
 	dionaudio-loco.dtbo \
diff --git a/arch/arm/boot/dts/overlays/balena-fin-overlay.dts b/arch/arm/boot/dts/overlays/balena-fin-overlay.dts
new file mode 100644
index 0000000..c9eeab5
--- /dev/null
+++ b/arch/arm/boot/dts/overlays/balena-fin-overlay.dts
@@ -0,0 +1,102 @@
+/dts-v1/;
+/plugin/;
+
+/ {
+	compatible = "brcm,bcm2708";
+
+	fragment@0 {
+		target = <0xffffffff>;
+
+		__overlay__ {
+			pinctrl-names = "default";
+			pinctrl-0 = <0x1>;
+			bus-width = <0x4>;
+			brcm,overclock-50 = <0x23>;
+			status = "okay";
+		};
+	};
+
+	fragment@1 {
+		target = <0xffffffff>;
+
+		__overlay__ {
+
+			sdio_pins {
+				brcm,pins = <0x22 0x23 0x24 0x25 0x26 0x27>;
+				brcm,function = <0x7>;
+				brcm,pull = <0x0 0x2 0x2 0x2 0x2 0x2>;
+				phandle = <0x1>;
+			};
+
+			power_ctrl_pins {
+				brcm,pins = <0x28>;
+				brcm,function = <0x1>;
+			};
+		};
+	};
+
+	fragment@2 {
+		target-path = [2f 00];
+
+		__overlay__ {
+
+			power_ctrl {
+				compatible = "gpio-poweroff";
+				gpios = <0xffffffff 0x28 0x1>;
+				force;
+			};
+
+			i2c@0 {
+				compatible = "i2c-gpio";
+				gpios = <0xffffffff 0x2b 0x0 0xffffffff 0x2a 0x0>;
+				i2c-gpio,delay-us = <0x2>;
+				#address-cells = <0x1>;
+				#size-cells = <0x0>;
+				phandle = <0x2>;
+			};
+		};
+	};
+
+	fragment@3 {
+		target = <0x2>;
+
+		__overlay__ {
+			#address-cells = <0x1>;
+			#size-cells = <0x0>;
+			status = "okay";
+
+			gpio_expander@20 {
+				compatible = "nxp,pca9554";
+				gpio-controller;
+				#gpio-cells = <0x2>;
+				reg = <0x20>;
+				status = "okay";
+			};
+
+			ds1307@68 {
+				compatible = "maxim,ds1307";
+				reg = <0x68>;
+				status = "okay";
+			};
+		};
+	};
+
+	__fixups__ {
+		mmc = "/fragment@0:target:0";
+		gpio = "/fragment@1:target:0", "/fragment@2/__overlay__/power_ctrl:gpios:0", "/fragment@2/__overlay__/i2c@0:gpios:0", "/fragment@2/__overlay__/i2c@0:gpios:12";
+	};
+
+	__local_fixups__ {
+
+		fragment@0 {
+
+			__overlay__ {
+				pinctrl-0 = <0x0>;
+			};
+		};
+
+		fragment@3 {
+			target = <0x0>;
+		};
+	};
+};
-- 
2.7.4

