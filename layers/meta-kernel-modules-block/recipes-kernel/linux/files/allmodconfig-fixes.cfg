# Fixes for allmodconfig build issues on Raspberry Pi
#
# allmodconfig enables EVERYTHING which causes build failures and
# incompatibilities. This fragment disables problematic options.

# Disable CONFIG_LOCALVERSION_AUTO to ensure consistent module versioning
# with the main OS kernel
# CONFIG_LOCALVERSION_AUTO is not set

# Disable debug options that bloat the build significantly
# CONFIG_DEBUG_INFO_DWARF5 is not set
# CONFIG_DEBUG_INFO_BTF is not set
# CONFIG_GCC_PLUGINS is not set

# Disable sanitizers - they modify kernel ABI and break module loading
# CONFIG_KASAN is not set
# CONFIG_KCSAN is not set
# CONFIG_KMSAN is not set
# CONFIG_UBSAN is not set

# Disable options that require specific test infrastructure
# CONFIG_TEST_KMOD is not set
# CONFIG_TEST_FIRMWARE is not set

# Ensure module compression matches main OS (zstd)
CONFIG_MODULE_COMPRESS_ZSTD=y

# Disable Rust support (not available in standard RPi kernel)
# CONFIG_RUST is not set

# Disable kernel live patching (not compatible with module loading)
# CONFIG_LIVEPATCH is not set

# Disable RANDSTRUCT which randomizes struct layouts and breaks ABI
# CONFIG_RANDSTRUCT_FULL is not set
# CONFIG_RANDSTRUCT_PERFORMANCE is not set
# CONFIG_RANDSTRUCT is not set

# Disable CFI (Control Flow Integrity) which affects function call ABI
# CONFIG_CFI_CLANG is not set

# Disable shadow call stack which affects ABI
# CONFIG_SHADOW_CALL_STACK is not set

# Disable framebuffer console - has unused variable bug in kernel 6.12
# (fullscreen_logo_enabled scope mismatch with #ifndef MODULE)
# CONFIG_FRAMEBUFFER_CONSOLE is not set

# Disable UAPI header testing - pisp_be_config.h uses uint8_t instead of __u8
# causing "unknown type name 'uint8_t'" errors during HDRTEST
# CONFIG_UAPI_HEADER_TEST is not set

# Disable Raspberry Pi drivers that use unexported kernel symbols
# These fail modpost when built as modules (allmodconfig)
# CONFIG_COMMON_CLK_RP1 is not set
# CONFIG_MFD_RP1 is not set
# CONFIG_DRM_VC4 is not set

# Disable Raspberry Pi drivers that depend on rpi_firmware/bcm_dma functions
# These fail linking when built-in but firmware driver is modular
# CONFIG_GPIO_BCM_VIRT is not set
# CONFIG_CLK_BCM2835 is not set
# CONFIG_BCM2708_VCMEM is not set
